/*
 * RailsAdmin remote form @VERSION
 *
 * License
 *
 * http://www.railsadmin.org
 *
 * Depends:
 *   jquery.ui.core.js
 *   jquery.ui.widget.js
 *   jquery.ui.dialog.js
 */
(function(a){a.widget("ra.remoteForm",{dialog:null,options:{dialogClass:"",height:600,width:720},_create:function(){var b=this,c=a(this.element).siblings("select").data("edit-url");typeof c!="undefined"&&c.length&&a("#"+this.element.parent().parent().attr("id")+" .ra-multiselect option").live("dblclick",function(d){d.preventDefault();if(a("#modal").length)return!1;var e=b._getModal();a.ajax({url:c.replace("__ID__",this.value),beforeSend:function(a){a.setRequestHeader("Accept","text/javascript")},success:function(a,c,d){e.find(".modal-body").html(a),b._bindFormEvents()},error:function(a,b,c){e.find(".modal-body").html(a.responseText)},dataType:"text"})}),a(b.element).bind("click",function(c){c.preventDefault();if(a("#modal").length)return!1;var d=b._getModal();a.ajax({url:a(this).attr("href"),beforeSend:function(a){a.setRequestHeader("Accept","text/javascript")},success:function(a,c,e){d.find(".modal-body").html(a),b._bindFormEvents()},error:function(a,b,c){d.find(".modal-body").html(a.responseText)},dataType:"text"})})},_bindFormEvents:function(){var b=this._getModal(),c=b.find("form"),d=this,e=b.find(":submit[name=_save]").text(),f=b.find(":submit[name=_continue]").text();b.find(".actions").remove(),c.attr("data-remote",!0),d.dialog.find(".modal-header-title").text(c.data("title")),d.dialog.find(".cancel-action").click(function(){return d.dialog.modal("hide"),!1}).text(f),d.dialog.find(".save-action").click(function(){return b.find("form").submit(),!1}).text(e),a("form").live("ajax:complete",function(c,e,f){var g=a.parseJSON(e.responseText),h='<option value="'+g.id+'" selected>'+g.label+"</option>",i=d.element.siblings("select");if(d.element.siblings(".input-append").length){var j=d.element.siblings(".input-append").children(".ra-filtering-select-input");j.length>0&&(j[0].value=g.label),i.length>0&&(i.html(h),i[0].value=g.id)}else{var j=d.element.siblings(".ra-filtering-select-input"),k=d.element.siblings(".ra-multiselect");i.find("option[value="+g.id+"]").length?(i.find("option[value="+g.id+"]").text(g.label),k.find("option[value= "+g.id+"]").text(g.label)):(i.prepend(h),k.find("select.ra-multiselect-selection").prepend(h))}b.modal("hide")}),a("form").live("ajax:error",function(a,c,e,f){b.find(".modal-body").html(c.responseText),d._bindFormEvents()})},_getModal:function(){var b=this;return b.dialog||(b.dialog=a('          <div id="modal" class="modal">            <div class="modal-header">              <a href="#" class="close">&times;</a>              <h3 class="modal-header-title">...</h3>            </div>            <div class="modal-body">              ...            </div>            <div class="modal-footer">              <a href="#" class="btn secondary cancel-action">...</a>              <a href="#" class="btn primary save-action">...</a>            </div>          </div>').modal({keyboard:!0,backdrop:!0,show:!0}).bind("hidden",function(){b.dialog.remove(),b.dialog=null})),this.dialog}})})(jQuery)